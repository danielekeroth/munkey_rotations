# ============================================================================
# ROTATION CREATION MASTER TEMPLATE (Indexed Reference Version)
# ============================================================================
# The AI uses QUICK_REFERENCE.yaml as primary guide, and fetches specific
# sections from reference_guide.yaml using the index when needed.
#
# STARTING FILE: rotation_template.yaml contains the must-have structure.
# Copy it as a base and adapt for the specific class/spec.
# ============================================================================

STEP 1: REFERENCE PREPARATION
=============================

Read these files in order:
  1. QUICK_REFERENCE.yaml           # Primary guide (~400 lines)
  2. reference_guide_index.yaml     # Index for detailed lookups
  3. rotation_template.yaml         # Starting template with must-haves

You do NOT need to read the full reference_guide.yaml upfront.
Use the index to fetch only relevant sections as needed during implementation.

STOP: Confirm once you've reviewed the quick reference, index, and template.

STEP 2: GUIDE RESEARCH (After Approval)
=======================================

I want you to implement rotation profiles for Feral Druid based on:

PROFILES TO IMPLEMENT:
  1. WoWHead
     URL: https://www.wowhead.com/guide/classes/druid/feral/rotation-cooldowns-pve-dps
     
  2. Icy Veins
     URL: https://www.icy-veins.com/wow/feral-druid-pve-dps-rotation-cooldowns-abilities

  3. Method.gg
     URL: https://www.method.gg/guides/feral-druid/playstyle-and-rotation

If URLs are not provided, search for:
  - "[Source] [Class] [Spec] rotation guide [current patch]"

For each guide, extract:
  - Opener sequence
  - Single Target priority
  - AOE priority
  - Hero talent specific mechanics (if applicable)
  - Cooldown alignment rules
  - Resource pooling guidelines
  - Any special mechanics (empowered spells, procs, etc.)

STOP: After extracting all guides, STOP and summarize your findings:
  - Key differences between the profiles
  - Any unclear mechanics that need clarification
  - Hero talent detection needed (list them)

Wait for my approval before implementing.

STEP 3: IMPLEMENTATION (After Approval)
=======================================

⚠️  CRITICAL: Start by copying rotation_template.yaml as your base file!
    This ensures all must-have structure is present:
      - Metadata header (version, spec, name, description, author, date, patch)
      - movement_allowed at ROOT level
      - Config: profile dropdown + aoe_threshold + defensives toggle
      - Variables: hero talent detection, pooling logic
      - Lists: main, defensives, cooldowns, [profile1]_st, [profile1]_aoe, etc.

⚠️  CRITICAL: Build the rotation content from SCRATCH using QUICK_REFERENCE.yaml 
    as primary guide. Fetch specific sections from reference_guide.yaml 
    using the index ONLY when you need to verify syntax or look up edge cases.
    DO NOT copy patterns from existing rotation files!

⚠️  CRITICAL: Do NOT! perform any YAML validation as we're utilizing the
    SimC (Simulation Craft engine) which does not adhere to all YAML standards.

⚠️  BEFORE WRITING ANY SPELL CONDITIONS:
    Check morph_database/{class}_morphs.yaml for spell transformations!
    If a spell morphs (e.g., Azure Strike → Azure Sweep), you MUST use:
      azure_sweep,override=azure_strike,if=buff.azure_sweep.up
    NOT just: azure_strike,if=buff.azure_sweep.down (this BREAKS the rotation!)

Create file: [Class]/{LLM}_rotation_{CLASS_ID}_{AUTHOR}.yaml

Implementation steps:
  1. Copy rotation_template.yaml content as starting point
  2. Update metadata header with correct spec ID and description
  3. Adjust hero talent names in variables section for your class
  4. Rename source1/source2/source3 to actual guide names (wowhead, icyveins, method)
  5. Fill in each [source]_st and [source]_aoe list with priority from guides
  6. Add spell morphs with override= as needed from morph_database

When unsure about syntax, fetch the relevant section from reference_guide.yaml:
  - Example: ReadFile(path="reference_guide.yaml", line_offset=635, n_lines=225) 
    gets step_options (lines 635-859)

Before final submission, verify:
  [ ] Copied rotation_template.yaml as starting file
  [ ] Metadata header complete with spec ID
  [ ] movement_allowed at ROOT level (not in variables!)
  [ ] main list auto-executed (not called explicitly)
  [ ] Using '=' not '==' for equality
  [ ] Parentheses for & | precedence
  [ ] Empowered spells use ignore_usable + ignore_cooldown + casting_check
  [ ] All non-main lists called via call_action_list
  [ ] Config referenced as config.name, variables as var.name
  [ ] Spell morphs checked in morph_database/{class}_morphs.yaml

# ============================================================================
# QUICK START - MINIMAL INPUT
# ============================================================================
#
# Just fill in the brackets below:
#
# ---
# Create rotation profiles for [CLASS] [SPEC] based on:
#   1. Wowhead guide
#   2. Icy Veins guide
#   3. Method.gg guide
# 
# File: [Class]/{LLM}_rotation_[ID]_[author].yaml
# ---
#
# The AI will:
#   - Read QUICK_REFERENCE.yaml (primary)
#   - Read reference_guide_index.yaml (for lookups)
#   - Read rotation_template.yaml (starting structure)
#   - Find the guides automatically
#   - Extract rotation details
#   - Copy template as base and implement all profiles
#   - Add hero talent detection if needed
#   - Fetch reference sections as needed for verification
#
# ============================================================================

# ============================================================================
# INDEX REFERENCE - When to fetch from reference_guide.yaml
# ============================================================================
#
# Use these index entries to fetch specific sections when needed:
#
# For empowered spells (Evoker):
#   - step_options [635, 859]     (ignore_usable, casting_check)
#   - player_status [955, 1023]   (player.empower_stage)
#
# For healing/targeting:
#   - healing_targeting [1383, 1574]  (cycle=, target=, group)
#   - cast_target_modifiers [2071, 2107]  (.player, .mouseover)
#
# For cooldown/trinket management:
#   - cooldowns [574, 609]
#   - equipment [1610, 1693]
#
# For AOE:
#   - enemy_combat_count [1347, 1382]  (active_enemies)
#
# For config setup:
#   - config_options [1903, 1985]
#   - user_variables [1885, 1902]
#
# ============================================================================
